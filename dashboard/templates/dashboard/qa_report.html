{% extends "dashboard/base.html" %}

{% block content %}
    <h1>Reporte de Evaluaciones QA</h1>
    
    <!-- Formulario de filtro -->
    <form method="get">
        <label for="agent">Agente:</label>
        <select name="agent" id="agent">
            <option value="">--Todos--</option>
            {% for agent in agents %}
                <option value="{{ agent.agent_name }}" {% if selected_agent == agent.agent_name %}selected{% endif %}>
                    {{ agent.agent_name }}
                </option>
            {% endfor %}
        </select>
        <br><br>
        <label for="team">Equipo:</label>
        <select name="team" id="team">
            <option value="">--Todos--</option>
            {% for team in teams %}
                <option value="{{ team }}" {% if selected_team == team %}selected{% endif %}>
                    {{ team }}
                </option>
            {% endfor %}
        </select>
        <br><br>
        <label for="week_start">Inicio:</label>
        <input type="date" name="week_start" id="week_start" value="{{ week_start }}">
        <label for="week_end">Fin:</label>
        <input type="date" name="week_end" id="week_end" value="{{ week_end }}">
        <br><br>
        <button type="submit">Filtrar</button>
    </form>
    
    <br>
    <!-- Recuadro con el promedio de total_final_score -->
    {% if qa_avg %}
        <div style="border: 1px solid #ccc; padding: 10px; background-color: #f8f8f8;">
            <strong>Promedio de Total Final Score (QA):</strong> {{ qa_avg|floatformat:2 }}
        </div>
    {% elif selected_agent or selected_team or week_start and week_end %}
        <div style="border: 1px solid #ccc; padding: 10px; background-color: #f8f8f8;">
            <strong>No hay evaluaciones QA para los filtros seleccionados.</strong>
        </div>
    {% endif %}
    
    <br>
    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>Clave Evaluación</th>
                <th>Prioridad</th>
                <th>Tipo</th>
                <th>Agente</th>
                <th>Fecha de Interacción</th>
                <th>Supervisor</th>
                <th>Status</th>
                <th>Updated</th>
                <th>Total Final Score</th>
            </tr>
        </thead>
        <tbody>
            {% for qa in qa_evals %}
            <tr>
                <td>{{ qa.evaluation_key }}</td>
                <td>{{ qa.priority }}</td>
                <td>{{ qa.type }}</td>
                <td>{{ qa.agent.agent_name }}</td>
                <td>{{ qa.interaction_date }}</td>
                <td>{% if qa.supervisor %}{{ qa.supervisor.agent_name }}{% endif %}</td>
                <td>{{ qa.status }}</td>
                <td>{{ qa.updated }}</td>
                <td>{{ qa.total_final_score }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9">No se encontraron evaluaciones.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
